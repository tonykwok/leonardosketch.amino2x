<?xml version="1.0" ?>
<project default="help">
    <target name="help">

    </target>

    <target name="init">
        <property name="tests.dir" value="samples/js"/>
        <property name="amino.path" value="dist/amino-0.01.js"/>
        <mkdir dir="build/webos/tests"/>
    </target>
    
    <target name="clean" depends="init">
        <delete dir="build/webos/samples"/>
    </target>

    <target name="build-apps">
        <antcall target="build-app"><param name="appname" value="photoadjust"/></antcall>
        <antcall target="build-app"><param name="appname" value="basicparticles"/></antcall>
        <antcall target="build-app"><param name="appname" value="blocks"/></antcall>
        <antcall target="build-app"><param name="appname" value="touchclock"/></antcall>
        <antcall target="build-app"><param name="appname" value="planetrover"/></antcall>
    </target>


    <target name="build-app" depends="init">
        <property name="appdir" value="build/webos/samples/${appname}"/>
        <mkdir dir="${appdir}"/>
        <copy todir="${appdir}">
            <fileset dir="${tests.dir}/${appname}">
                <include name="**"/>
            </fileset>
        </copy>
        
        <replaceregexp file="${appdir}/index.html"
            match='"(.+)/amino.js"'
            replace="'amino.js'"
            byline="true"
        />
        
        <copy tofile="${appdir}/amino.js" file="${amino.path}"/>

        <echo file="${appdir}/appinfo.json">
{
        "id": "com.joshondesign.amino.${appname}",
        "version": "0.0.1",
        "vendor": "Josh Marinacci",
        "type": "web",
        "main": "index.html",
        "title": "Amino ${appname}",
        "icon": "icon.png",
        "uiRevision" : 2,
        "dockMode": true        
}        </echo>


        <exec command="palm-package ${appname}" dir="build/webos/samples"/>
        <exec command="palm-install com.joshondesign.amino.${appname}_0.0.1_all.ipk" dir="build/webos/samples"/>
    </target>

    <target name="run-app" depends="init">
        <antcall target="build-app"/>
        <!--<param name="appname" value="visualizer"/></antcall>-->
        <exec command="palm-launch com.joshondesign.amino.${appname}" dir="build/webos/tests"/>
    </target>
</project>
